<!DOCTYPE html>
<html>
  <head>
    <title>FC AUDIO CHAT</title>
    <link rel="stylesheet" href="src/styles.css" />
    <link rel="stylesheet" href="https://use.typekit.net/tcr3qai.css">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="microphone=self, camera=self" />
    <meta name="fc:frame" content='{"version":"next","imageUrl":"https://cover-art.kasra.codes/fc-audio-chat-rectangle.png","button":{"title":"Start Chatting","action":{"type":"launch_frame","name":"FC Audio Chat","url":"https://fc-audio-chat.kasra.codes","splashImageUrl":"https://cover-art.kasra.codes/fc-audio-chat-square.png","splashBackgroundColor":"#6442BF"}}}' />
  </head>

  <body>
    <header>
      <div class="header-left">
        <h2>FC AUDIO CHAT</h2>
        <span id="user-greeting" class="user-greeting"></span>
      </div>
      <button id="leave-btn" class="btn-danger hide">Leave Room</button>
    </header>
    <form id="join" class="hide">
      <h2>Join Room</h2>
      <div class="input-container">
        <input id="name" type="text" name="username" placeholder="Your name" />
      </div>
      <button type="button" class="btn-primary" id="join-btn">
        Join
      </button>
    </form>

    <div id="rooms-list" class="rooms-section">
      <div class="rooms-header">
        <h2>Available Rooms</h2>
        <div class="rooms-actions">
          <button id="refresh-rooms-btn" class="btn-icon" title="Refresh Rooms">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20.4036 9.5H17.9036C17.3513 9.5 16.9036 9.05228 16.9036 8.5C16.9036 7.94772 17.3513 7.5 17.9036 7.5H22.0335C22.5858 7.5 23.0335 7.94772 23.0335 8.5V12.6299C23.0335 13.1822 22.5858 13.6299 22.0335 13.6299C21.4813 13.6299 21.0335 13.1822 21.0335 12.6299V10.9318C19.7535 15.0354 15.8817 18 11.2944 18C5.85112 18 1.41705 13.9706 1.00247 8.78091C0.95027 8.23232 1.36093 7.76148 1.90951 7.70928C2.4581 7.65708 2.92894 8.06774 2.98114 8.61633C3.31507 12.8891 6.93522 16.1667 11.2944 16.1667C15.0567 16.1667 18.2559 13.7167 19.2181 10.3623C19.2771 10.1391 19.3258 9.91152 19.363 9.68073C19.4521 9.11381 19.9193 8.72528 20.4863 8.8144C20.4913 8.81528 20.4963 8.81621 20.5013 8.8172C20.5063 8.81819 20.5114 8.81925 20.5164 8.82037C20.9862 8.91529 21.2913 9.36775 21.1963 9.83753C21.1283 10.142 21.0474 10.4403 20.9538 10.7311C20.9368 10.7778 20.9193 10.8242 20.9013 10.8703L20.4036 9.5Z" fill="currentColor"/>
              <path d="M3.59644 14.5H6.09644C6.64872 14.5 7.09644 14.9477 7.09644 15.5C7.09644 16.0523 6.64872 16.5 6.09644 16.5H1.96654C1.41426 16.5 0.966537 16.0523 0.966537 15.5V11.3701C0.966537 10.8178 1.41426 10.3701 1.96654 10.3701C2.51883 10.3701 2.96654 10.8178 2.96654 11.3701V13.0682C4.24651 8.96465 8.11834 6 12.7056 6C18.1489 6 22.583 10.0294 22.9975 15.2191C23.0497 15.7677 22.6391 16.2385 22.0905 16.2907C21.5419 16.3429 21.0711 15.9323 21.0189 15.3837C20.6849 11.1109 17.0648 7.83333 12.7056 7.83333C8.94333 7.83333 5.74411 10.2833 4.78189 13.6377C4.72287 13.8609 4.67423 14.0885 4.63703 14.3193C4.54789 14.8862 4.08065 15.2747 3.51372 15.1856C3.50871 15.1847 3.50371 15.1838 3.49873 15.1828C3.49373 15.1818 3.48865 15.1808 3.48357 15.1796C3.01379 15.0847 2.70868 14.6323 2.80367 14.1625C2.87173 13.858 2.95265 13.5597 3.04619 13.2689C3.06319 13.2222 3.08069 13.1758 3.09869 13.1297L3.59644 14.5Z" fill="currentColor"/>
            </svg>
          </button>
          <button id="create-room-btn" class="btn-primary">Create Room</button>
        </div>
      </div>
      <div class="rooms-container">
        <!-- Rooms will be populated here by loadRooms() -->
      </div>
    </div>

    <div id="create-room-modal" class="modal hide">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Create Room</h3>
          <button class="close-button" data-modal="create-room-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div id="frame-status" class="frame-status">
            <span class="status-indicator"></span>
            <span class="status-text">Checking Farcaster connection...</span>
          </div>
          <form id="create-room-form">
            <input id="eth-address" type="hidden" />
            <input id="fid" type="hidden" />
            <div id="frame-not-connected" class="frame-not-connected hide">
              <p>Please connect via Farcaster Frame to create a room.</p>
            </div>
            <p class="create-room-description">
              Start an audio chat room where you can talk with other Farcaster users. You'll join as the host with speaking privileges.
            </p>
            <div id="create-room-actions" class="create-room-actions">
              <button type="submit" class="btn-primary create-room-btn">Create Audio Room</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="conference" class="conference-section hide">
      <div class="spaces-container">
        <div class="spaces-header">
          <div class="room-info">
            <h3 id="room-title">Audio Room</h3>
            <div class="room-status">
              <span class="live-indicator">LIVE</span>
              <span id="room-duration">00:00</span>
            </div>
          </div>
          <div class="room-actions">
            <button id="share-warpcast" class="btn-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 8C19.6569 8 21 6.65685 21 5C21 3.34315 19.6569 2 18 2C16.3431 2 15 3.34315 15 5C15 5.12548 15.0077 5.24917 15.0227 5.37063L8.08509 9.04413C7.54346 8.40222 6.8089 8 6 8C4.34315 8 3 9.34315 3 11C3 12.6569 4.34315 14 6 14C6.8089 14 7.54346 13.5978 8.08509 12.9559L15.0227 16.6294C15.0077 16.7508 15 16.8745 15 17C15 18.6569 16.3431 20 18 20C19.6569 20 21 18.6569 21 17C21 15.3431 19.6569 14 18 14C17.1911 14 16.4565 14.4022 15.9149 15.0441L8.97733 11.3706C8.99229 11.2492 9 11.1255 9 11C9 10.8745 8.99229 10.7508 8.97733 10.6294L15.9149 6.95587C16.4565 7.59778 17.1911 8 18 8Z" fill="currentColor"/>
              </svg>
            </button>
            <button id="leave-room-btn" class="btn-danger-small">Leave</button>
          </div>
        </div>
        
        <div class="spaces-content">
          <div class="speakers-section">
            <h4>Speakers</h4>
            <div id="speakers-list" class="speakers-list"></div>
          </div>
          
          <div class="listeners-section">
            <h4>Listeners <span id="listeners-count" class="count-badge">0</span></h4>
            <div id="listeners-list" class="listeners-list"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="controls" class="control-bar hide">
      <button id="mute-aud" class="btn-control">
        <svg class="mic-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 14C13.6569 14 15 12.6569 15 11V5C15 3.34315 13.6569 2 12 2C10.3431 2 9 3.34315 9 5V11C9 12.6569 10.3431 14 12 14Z" fill="currentColor"/>
          <path d="M18.9273 11C18.9273 11.5523 18.4796 12 17.9273 12C17.375 12 16.9273 11.5523 16.9273 11C16.9273 8.23858 14.7614 6 12 6C9.23858 6 7 8.23858 7 11C7 11.5523 6.55228 12 6 12C5.44772 12 5 11.5523 5 11C5 7.13401 8.13401 4 12 4C15.866 4 18.9273 7.13401 18.9273 11Z" fill="currentColor"/>
          <path d="M7 11C7 11.5523 6.55228 12 6 12C5.44772 12 5 11.5523 5 11C5 7.13401 8.13401 4 12 4C15.866 4 19 7.13401 19 11C19 11.5523 18.5523 12 18 12C17.4477 12 17 11.5523 17 11C17 8.23858 14.7614 6 12 6C9.23858 6 7 8.23858 7 11Z" fill="currentColor"/>
          <path d="M12 16C15.866 16 19 12.866 19 9C19 8.44772 19.4477 8 20 8C20.5523 8 21 8.44772 21 9C21 13.9706 16.9706 18 12 18C7.02944 18 3 13.9706 3 9C3 8.44772 3.44772 8 4 8C4.55228 8 5 8.44772 5 9C5 12.866 8.13401 16 12 16Z" fill="currentColor"/>
          <path d="M12 18C11.4477 18 11 18.4477 11 19V21C11 21.5523 11.4477 22 12 22C12.5523 22 13 21.5523 13 21V19C13 18.4477 12.5523 18 12 18Z" fill="currentColor"/>
        </svg>
        <span>Mute</span>
      </button>
      
      <div id="host-controls" class="host-controls hide">
        <button id="end-room" class="btn-control danger">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10.5858 12L4.92893 17.6569C4.53841 18.0474 4.53841 18.6805 4.92893 19.0711C5.31946 19.4616 5.95262 19.4616 6.34315 19.0711L12 13.4142L17.6569 19.0711C18.0474 19.4616 18.6805 19.4616 19.0711 19.0711C19.4616 18.6805 19.4616 18.0474 19.0711 17.6569L13.4142 12L19.0711 6.34315C19.4616 5.95262 19.4616 5.31946 19.0711 4.92893C18.6805 4.53841 18.0474 4.53841 17.6569 4.92893L12 10.5858L6.34315 4.92893C5.95262 4.53841 5.31946 4.53841 4.92893 4.92893C4.53841 5.31946 4.53841 5.95262 4.92893 6.34315L10.5858 12Z" fill="currentColor"/>
          </svg>
          <span>End Room</span>
        </button>
      </div>
    </div>
    
    <div id="listener-action-modal" class="modal hide">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Participant Actions</h3>
          <button class="close-button" data-modal="listener-action-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="listener-info">
            <div class="listener-avatar">
              <span id="listener-initial">?</span>
            </div>
            <span id="listener-name" class="listener-name-display">User Name</span>
          </div>
          
          <div id="creator-only-message" class="creator-only-message hide">
            <p>Only the room creator can promote listeners to speakers or demote speakers to listeners.</p>
          </div>
          
          <div class="action-description" id="promote-description">
            <h4>Invite to speak</h4>
            <p>Promoting a listener to speaker will allow them to unmute their microphone and speak in the room.</p>
          </div>
          
          <div class="action-description hide" id="demote-description">
            <h4>Move to listener</h4>
            <p>Moving a speaker back to listener will prevent them from speaking in the room.</p>
          </div>
          
          <div class="action-buttons">
            <button id="promote-listener" class="btn-primary">
              <span class="btn-icon">ðŸŽ¤</span> Invite to Speak
            </button>
            <button id="demote-speaker" class="btn-danger hide">
              <span class="btn-icon">ðŸ”‡</span> Move to Listeners
            </button>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="src/main.js"></script>
  </body>
</html>
